<server description="Game On! Map Service">

	<!-- Enable API discovery -->
    <include location="${server.config.dir}/apiDiscovery.xml"/>

    <!-- Enable features -->
    <featureManager>
        <feature>localConnector-1.0</feature>
        <feature>jaxrs-2.0</feature>
        <feature>cdi-1.2</feature>
        <feature>ssl-1.0</feature>
        <feature>couchdb-1.0</feature>
    </featureManager>

    <httpEndpoint host="*" httpPort="9080" httpsPort="9443" id="defaultHttpEndpoint">
        <accessLogging
            filepath="${server.output.dir}/logs/http_defaultEndpoint_access.log"
            logFormat='%h %u %t "%r" %s %b %D %{User-agent}i'>
        </accessLogging>    
    </httpEndpoint>

    <keyStore id="defaultKeyStore" password="testOnlyKeystore"/>
    <keyStore id="defaultTrustStore" location="truststore.jks" password="truststore"/>

	<sslDefault sslRef="DefaultSSLSettings" />
	<ssl id="DefaultSSLSettings" keyStoreRef="defaultKeyStore" trustStoreRef="defaultTrustStore" />

    <!-- This is required to prevent the web apps from being lazily loaded -->
    <webContainer deferServletLoad="false"/>
    
    <!-- Signed JWT keystore info -->
	<jndiEntry jndiName="jwtKeyStore" value="${server.config.dir}/resources/security/key.jks"/>
	<jndiEntry jndiName="jwtKeyStorePassword" value="testOnlyKeystore"/>
	<jndiEntry jndiName="jwtKeyStoreAlias" value="default"/>
	
	<jndiEntry jndiName="playerUrl" value="${env.MAP_PLAYER_URL}"/>
	
	<!-- This is our private backend room registration key, only used for recroom/nodejs etc -->
    <jndiEntry jndiName="registrationSecret" value="${env.MAP_KEY}"/>   
    
    <!-- The id we recognise as the system id. -->
    <jndiEntry jndiName="systemId" value="${env.SYSTEM_ID}"/>
    
    <!-- Sweep registration information -->
    <jndiEntry jndiName="sweepId" value="${env.SWEEP_ID}"/>
    <jndiEntry jndiName="sweepSecret" value="${env.SWEEP_SECRET}"/>

    <!-- <logging traceSpecification="*=info:net.wasdev.gameon.*=all" copySystemStreams="false"/> -->
    <!-- <logging traceSpecification="*=info:net.wasdev.gameon.*=all" /> -->
    <logging consoleLogLevel="INFO" traceSpecification="*=info:net.wasdev.gameon.*=all"/>
    
    <jndiEntry jndiName="serverName" value="${wlp.server.name}"/>
    <jndiEntry jndiName="serverOutputDir" value="${server.output.dir}"/>
    
    <jndiEntry jndiName="kafkaUrl" value="${env.KAFKA_URL}"/>

    <applicationMonitor dropinsEnabled="false" />

    <couchdb id="couchdb" 
      jndiName="couchdb/connector"
      libraryRef="couchdb-lib"
      url="${env.COUCHDB_URL}"
      username="${env.COUCHDB_USER}"
      password="${env.COUCHDB_PASSWORD}"/>

    <library id="couchdb-lib" >
        <fileset dir='${server.config.dir}/lib' />
    </library>

    <webApplication contextRoot="/map" id="map-app" location="map-app.war">
      <classloader commonLibraryRef="couchdb-lib"></classloader>
    </webApplication>

</server>
